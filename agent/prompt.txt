 Nhiệm vụ của bạn là Cập nhật trí nhớ về Ý ĐỊNH + CONTEXT của người dùng trở nên thật ngắn gọn, súc tích, diễn đạt được context mà cuộc trò chuyện đã trải qua
        
        USER STATUS: {"Returning user (Lần thứ 2+ chạy)" if is_returning_user else "New user (Lần đầu tiên)"}
        
        INPUT:
        - Previous summary:{json.dumps(last_summary, ensure_ascii=False) if last_summary else "None"}
        - Previous Intense Level: {prev_intense}
        - Recent messages: {recent_msgs}
        - Current user messages: {json.dumps(lastest_message, ensure_ascii=False)}
        - Is Returning User: {is_returning_user}

        Task:
        - Decide whether the user's intent is CONTINUING or CHANGED. 
        - If continuing: enrich or slightly update the summary.
        - If changed: replace the summary to reflect the new intent.
        - If returning user: Consider previous context more heavily and look for progression patterns.
        
        Rules:
        - Focus on user intent and context only.
        - If previous status is CONTINUING, current status is CHANGED, replace EVERYTHING
        - Ignore assistant messages.
        - Keep it concise and durable.
        - Do NOT guess emotions if unclear.
        - If previous summary IS NOT DEFINED, status MUST AUTOMATICALLY be set to CHANGED
        - For returning users, pay extra attention to how their situation has evolved
        - "intense" indicates the urgency or progression level of the user's intent,
        
        INTENSE DECISION RULES (STRICT):

        You MUST decide intense by PROGRESSION, not emotion.

        1. starting:
        - First time this intent appears
        - OR previous summary does not exist
        - OR user speaks in general / exploratory terms

        2. growing:
        - Same intent appears AGAIN
        - OR user adds more details / examples
        - OR user asks follow-up questions on same topic
        - Previous intense MUST be starting or growing
        - FOR RETURNING USERS: If they come back with the same problem, this is a strong signal for "growing"

        3. request_high_urgency:
        - User explicitly requests immediate action, help, or resolution
        - OR language indicates "cannot wait", "right now", "urgent"
        - OR repetition with frustration + demand for action
        - Previous intense MUST be growing
        - FOR RETURNING USERS: If they've been in "growing" before and return, consider escalating to this level

        IMPORTANT:
        - Intense can ONLY stay the same or increase.
        - NEVER decrease intense.
        - For returning users, be more sensitive to signs of progression.

        {{
            "intent": "",
            "main_topic": "",
            "intense": starting → growing → request_high_urgency
            "status": "continuing | changed",
            "key_context": []
            "confidence_score": float in range [0.0, 1.0],
            "is_returning_user": {is_returning_user}
        }}
        RETURN JSON ONLY 
        """